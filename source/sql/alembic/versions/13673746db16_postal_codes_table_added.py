"""postal_codes table added

Revision ID: 13673746db16
Revises: 29fc422c56cb
Create Date: 2015-04-27 17:08:52.775839

"""

# revision identifiers, used by Alembic.
revision = '13673746db16'
down_revision = '29fc422c56cb'

from alembic import op
import sqlalchemy as sa
import geoalchemy2 as ga
from sqlalchemy.dialects import postgresql


def upgrade():
    ### commands auto generated by Alembic - please adjust! ###
    op.create_table(
        'postal_codes',
        sa.Column('admin_id', sa.BIGINT(), nullable=False),
        sa.Column('postal_code', sa.TEXT(), nullable=False),
        sa.ForeignKeyConstraint(['admin_id'], [u'georef.admin.id'], name=u'postal_codes_admin_id_fkey'),
        schema='georef',
    )
    op.execute(
        "INSERT INTO  georef.postal_codes (admin_id, postal_code) select id, post_code "
        "from georef.admin where post_code is not null"
    )
    op.drop_column('admin', 'post_code', schema='georef')
    ### end Alembic commands ###


def downgrade():
    ### commands auto generated by Alembic - please adjust! ###
    op.add_column('admin', sa.Column('post_code', sa.TEXT(), nullable=True), schema='georef')
    op.execute(
        "update georef.admin ga set post_code=pc.postal_code "
        "from georef.postal_codes pc where ga.id=pc.admin_id"
    )
    op.drop_table('postal_codes', schema='georef')
    ### end Alembic commands ###
